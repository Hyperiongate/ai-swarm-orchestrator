<!DOCTYPE html>
<html lang="en">
<head>
    <!--
    =============================================================================
    INDEX.HTML - AI Swarm Unified Interface
    Shiftwork Solutions LLC
    =============================================================================
    
    CHANGE LOG:
    - January 23, 2026: Added Research Agent Panel
      * Added "ğŸ”¬ Research" mode button in header
      * Added Research Info Panel in sidebar with:
        - Research status indicator
        - Industry News button
        - Regulations button
        - Research Studies button
        - Competitor Analysis button
        - Find Leads button
        - Daily Briefing button
      * Research Agent provides real-time web intelligence
    
    - January 23, 2026: Added Voice Control System
      * Added voice control section in sidebar with activation button
      * Added voice status indicator with animated dot
      * Added waveform animation for visual feedback
      * Added voice response toggle switch
      * Added voice input button (mic) next to Send button
      * Added swarm-voice.js script reference
      * Voice features: "Hey Swarm" wake word, text-to-speech responses
    
    - January 22, 2026: Added Persistent Conversation Memory System
      * Added conversation sidebar section with past conversations list
      * Added "New Conversation" button
      * Added memory status indicator above conversation area
      * Added conversation loading, deletion, and management
      * Messages now persist across sessions via backend API
    
    - January 22, 2026: Refactored from single 2000+ line file into 3 files
    - January 21, 2026: APPLIED ALL 5 FIXES FROM SWARM10
    - January 19, 2026: ENHANCED FEEDBACK SYSTEM
    
    FILE STRUCTURE:
    /templates/index.html              - This file (HTML structure)
    /static/css/swarm-styles.css       - All CSS styles (includes voice styles)
    /static/js/swarm-app.js            - Core JavaScript functionality
    /static/js/swarm-voice.js          - Voice control module
    
    =============================================================================
    -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Swarm - Unified Interface | Shiftwork Solutions</title>
    <link rel="stylesheet" href="/static/css/swarm-styles.css">
    <style>
        /* Research Panel Styles - Added January 23, 2026 */
        .research-info {
            display: none;
            padding: 15px;
            background: linear-gradient(135deg, #e8f5e9 0%, #e3f2fd 100%);
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .research-info h3 {
            margin-bottom: 10px;
            color: #2e7d32;
        }
        
        .research-status {
            padding: 10px;
            background: white;
            border-radius: 6px;
            font-size: 12px;
            margin-bottom: 15px;
            border-left: 3px solid #4caf50;
        }
        
        .research-status.error {
            border-left-color: #f44336;
            background: #ffebee;
        }
        
        .research-btn {
            width: 100%;
            padding: 10px;
            margin-bottom: 8px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            font-size: 13px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .research-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .research-btn.news { background: linear-gradient(135deg, #1976d2 0%, #42a5f5 100%); color: white; }
        .research-btn.regulations { background: linear-gradient(135deg, #7b1fa2 0%, #ab47bc 100%); color: white; }
        .research-btn.studies { background: linear-gradient(135deg, #388e3c 0%, #66bb6a 100%); color: white; }
        .research-btn.competitors { background: linear-gradient(135deg, #f57c00 0%, #ffb74d 100%); color: white; }
        .research-btn.leads { background: linear-gradient(135deg, #d32f2f 0%, #ef5350 100%); color: white; }
        .research-btn.briefing { 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: white;
            padding: 12px;
            font-size: 14px;
        }
        
        .research-section-title {
            font-size: 13px;
            font-weight: 600;
            color: #555;
            margin: 15px 0 8px 0;
            padding-bottom: 5px;
            border-bottom: 1px solid #e0e0e0;
        }
        
        .research-results {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 10px;
        }
        
        .research-result-item {
            padding: 10px;
            background: white;
            border-radius: 6px;
            margin-bottom: 8px;
            border-left: 3px solid #667eea;
        }
        
        .research-result-item h4 {
            font-size: 13px;
            margin-bottom: 5px;
            color: #333;
        }
        
        .research-result-item p {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
        }
        
        .research-result-item a {
            font-size: 11px;
            color: #667eea;
            text-decoration: none;
        }
        
        .research-result-item a:hover {
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- HEADER SECTION -->
        <div class="header">
            <div class="header-left">
                <h1>ğŸ¤– AI Swarm - Unified Interface</h1>
                <p>Quick tasks + Project workflows with learning feedback</p>
            </div>
            <div class="mode-switcher">
                <button class="mode-btn active" onclick="switchMode('quick')" id="quickModeBtn">âš¡ Quick Task</button>
                <button class="mode-btn" onclick="switchMode('project')" id="projectModeBtn">ğŸ“ Project</button>
                <button class="mode-btn" onclick="switchMode('calculator')" id="calculatorModeBtn">ğŸ§® Calculator</button>
                <button class="mode-btn" onclick="switchMode('survey')" id="surveyModeBtn">ğŸ“‹ Survey</button>
                <button class="mode-btn" onclick="switchMode('marketing')" id="marketingModeBtn">ğŸ“¢ Marketing</button>
                <button class="mode-btn" onclick="switchMode('opportunities')" id="opportunitiesModeBtn">ğŸ¯ Opportunities</button>
                <button class="mode-btn" onclick="switchMode('research')" id="researchModeBtn">ğŸ”¬ Research</button>
            </div>
        </div>
        
        <!-- MAIN GRID LAYOUT -->
        <div class="main-grid">
            
            <!-- SIDEBAR -->
            <div class="sidebar">
                
                <!-- VOICE CONTROL SECTION (NEW) -->
                <div class="voice-control-section" id="voiceControlSection">
                    <div class="voice-control-header">
                        <h3>ğŸ¤ Voice Control</h3>
                    </div>
                    <button class="voice-activate-btn" id="voiceActivateBtn" onclick="toggleVoiceMode()">
                        ğŸ¤ Activate Voice
                    </button>
                    <div class="voice-status-indicator">
                        <span class="voice-status-dot" id="voiceStatusDot"></span>
                        <span class="voice-status-text" id="voiceStatusText">Voice inactive - Click to activate</span>
                    </div>
                    <div class="voice-waveform" id="voiceWaveform">
                        <span class="wave-bar"></span>
                        <span class="wave-bar"></span>
                        <span class="wave-bar"></span>
                        <span class="wave-bar"></span>
                        <span class="wave-bar"></span>
                    </div>
                    <div class="voice-response-toggle-container">
                        <span class="voice-response-label" id="voiceResponseLabel">Voice responses ON</span>
                        <label class="voice-toggle-switch">
                            <input type="checkbox" id="voiceResponseToggle" checked onchange="toggleVoiceResponse()">
                            <span class="voice-toggle-slider"></span>
                        </label>
                    </div>
                    <div class="voice-hint" id="voiceHint">
                        Click <strong>Activate Voice</strong> to start
                    </div>
                </div>
                
                <!-- CONVERSATIONS SECTION (Memory Feature) -->
                <div class="conversations-section">
                    <div class="conversations-header">
                        <h3>ğŸ’¬ Conversations</h3>
                        <button class="new-conversation-btn" onclick="startNewConversation()" title="Start new conversation">â• New</button>
                    </div>
                    <div class="conversations-list" id="conversationsList">
                        <div class="conversations-loading">Loading conversations...</div>
                    </div>
                </div>
                
                <!-- Stats Section -->
                <h3>ğŸ“Š System Stats</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="totalTasks">0</div>
                        <div class="stat-label">Tasks</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="avgRating">-</div>
                        <div class="stat-label">Avg Rating</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="knowledgeDocs">22</div>
                        <div class="stat-label">Documents</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="consensusAccuracy">-</div>
                        <div class="stat-label">Accuracy</div>
                    </div>
                </div>
                
                <!-- Project Info Panel (project mode only) -->
                <div class="project-info" id="projectInfo">
                    <h3 style="margin-bottom: 10px;">Current Project</h3>
                    <label>Select Existing Project</label>
                    <select id="existingProjects" onchange="loadExistingProject()" style="width: 100%; padding: 8px; margin-bottom: 10px; border: 2px solid #e0e0e0; border-radius: 6px;">
                        <option value="">-- Select Project --</option>
                    </select>
                    <label>Client</label>
                    <span id="clientName">No active project</span>
                    <label>Phase</label>
                    <span id="projectPhase"><div class="phase-indicator">Not started</div></span>
                    <button onclick="startNewProject()" style="width: 100%; padding: 10px; margin-top: 10px; background: #667eea; color: white; border: none; border-radius: 8px; cursor: pointer;">+ New Project</button>
                </div>
                
                <!-- Marketing Info Panel (marketing mode only) -->
                <div class="marketing-info" id="marketingInfo" style="display: none;">
                    <h3 style="margin-bottom: 10px;">Marketing Hub</h3>
                    <div style="font-size: 12px; margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">Platform Status:</div>
                        <div id="platformStatus" style="padding: 10px; background: #f0f0f0; border-radius: 6px;">Loading...</div>
                    </div>
                    <h4 style="font-size: 14px; margin-bottom: 8px;">ğŸ’¡ AI Initiative</h4>
                    <button onclick="generateMarketingIdea()" style="width: 100%; padding: 12px; margin-bottom: 15px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; border-radius: 10px; cursor: pointer; font-weight: 700; font-size: 14px; box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);">ğŸš€ "Hey Jim, I have an idea!"</button>
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Quick Actions</h4>
                    <button onclick="generateSocialPost()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #0077b5; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ“ Generate LinkedIn Post</button>
                    <button onclick="conductResearch()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #764ba2; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ” Market Research</button>
                    <button onclick="analyzeCompetitors()" style="width: 100%; padding: 8px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ“Š Competitive Analysis</button>
                </div>
                
                <!-- Calculator Panel (calculator mode only) -->
                <div class="calculator-info" id="calculatorInfo" style="display: none;">
                    <h3 style="margin-bottom: 10px;">Cost Calculator</h3>
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Quick Calculations</h4>
                    <button onclick="calculateOvertimeCost()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ’° Overtime Cost</button>
                    <button onclick="compareHireVsOT()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #764ba2; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ‘¥ Hire vs OT</button>
                    <button onclick="scheduleImpact()" style="width: 100%; padding: 8px; background: #0077b5; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ“Š Schedule Impact</button>
                </div>
                
                <!-- Survey Panel (survey mode only) -->
                <div class="survey-info" id="surveyInfo" style="display: none;">
                    <h3 style="margin-bottom: 10px;">Survey Builder</h3>
                    <div style="font-size: 12px; margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">Question Bank:</div>
                        <div id="questionBankStatus" style="padding: 10px; background: #f0f0f0; border-radius: 6px;">Loading...</div>
                    </div>
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Quick Actions</h4>
                    <button onclick="createNewSurvey()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">â• Create Survey</button>
                    <button onclick="viewSurveyResults()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #0077b5; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ“Š View Results</button>
                    <button onclick="exportSurveyData()" style="width: 100%; padding: 8px; background: #764ba2; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ“¤ Export Data</button>
                </div>
                
                <!-- Opportunities Panel (opportunities mode only) -->
                <div class="opportunities-info" id="opportunitiesInfo" style="display: none;">
                    <h3 style="margin-bottom: 10px;">ğŸ¯ Opportunity Finder</h3>
                    <div style="font-size: 12px; margin-bottom: 15px;">
                        <div style="font-weight: 600; margin-bottom: 5px;">Database Status:</div>
                        <div id="normativeStatus" style="padding: 10px; background: #f0f0f0; border-radius: 6px;">Loading...</div>
                    </div>
                    <h4 style="font-size: 14px; margin-bottom: 8px;">Quick Analysis</h4>
                    <button onclick="analyzeScheduleOpportunities()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #667eea; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ“Š Analyze Current Schedule</button>
                    <button onclick="compareToNorms()" style="width: 100%; padding: 8px; margin-bottom: 8px; background: #764ba2; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ“ˆ Compare to Industry</button>
                    <button onclick="findImprovements()" style="width: 100%; padding: 8px; background: #0077b5; color: white; border: none; border-radius: 6px; cursor: pointer;">ğŸ’¡ Find Improvements</button>
                </div>
                
                <!-- Research Panel (research mode only) - NEW January 23, 2026 -->
                <div class="research-info" id="researchInfo" style="display: none;">
                    <h3>ğŸ”¬ Research Agent</h3>
                    <div class="research-status" id="researchStatus">
                        <strong>Status:</strong> Checking...
                    </div>
                    
                    <div class="research-section-title">ğŸ“‹ Daily Intelligence</div>
                    <button class="research-btn briefing" onclick="getDailyBriefing()">
                        ğŸ“° Get Daily Briefing
                    </button>
                    
                    <div class="research-section-title">ğŸ” Quick Research</div>
                    <button class="research-btn news" onclick="searchIndustryNews()">
                        ğŸ“° Industry News
                    </button>
                    <button class="research-btn regulations" onclick="searchRegulations()">
                        âš–ï¸ Regulations & Compliance
                    </button>
                    <button class="research-btn studies" onclick="searchStudies()">
                        ğŸ”¬ Research Studies
                    </button>
                    
                    <div class="research-section-title">ğŸ“Š Competitive Intelligence</div>
                    <button class="research-btn competitors" onclick="searchCompetitors()">
                        ğŸ¢ Competitor Analysis
                    </button>
                    <button class="research-btn leads" onclick="searchLeads()">
                        ğŸ¯ Find Potential Leads
                    </button>
                    
                    <div class="research-section-title">ğŸ” Custom Search</div>
                    <input type="text" id="researchQuery" placeholder="Enter research topic..." style="width: 100%; padding: 10px; border: 2px solid #e0e0e0; border-radius: 6px; margin-bottom: 8px; box-sizing: border-box;">
                    <button class="research-btn" style="background: linear-gradient(135deg, #455a64 0%, #78909c 100%); color: white;" onclick="customResearch()">
                        ğŸ” Research Topic
                    </button>
                </div>
                
                <!-- Quick Actions Section -->
                <h3 style="margin-top: 20px;">Quick Actions</h3>
                <ul class="quick-actions" id="quickActions"></ul>
                
                <!-- Generated Documents Section -->
                <h3 style="margin-top: 20px;">ğŸ“„ Documents</h3>
                <div id="documentsList" style="font-size: 12px; max-height: 200px; overflow-y: auto;">
                    <div style="color: #999; padding: 10px; text-align: center;">No documents yet</div>
                </div>
                <button onclick="refreshDocuments()" style="width: 100%; padding: 8px; margin-top: 10px; background: #f0f0f0; border: 1px solid #e0e0e0; border-radius: 6px; cursor: pointer; font-size: 12px; color: #666;">ğŸ”„ Refresh</button>
            </div>
            
            <!-- MAIN CONTENT AREA -->
            <div class="main-content">
                
                <!-- MEMORY STATUS INDICATOR (Memory Feature) -->
                <div class="memory-indicator" id="memoryIndicator">
                    <div class="memory-status warning" id="memoryStatus">
                        <span class="memory-icon">âš ï¸</span>
                        <span class="memory-text">Initializing conversation memory...</span>
                    </div>
                </div>
                
                <!-- Conversation Display -->
                <div class="conversation" id="conversation">
                    <div class="message assistant">
                        <div class="message-header">
                            ğŸ¤– AI Swarm
                            <span class="mode-indicator quick" id="initialModeIndicator">âš¡ Quick Task Mode</span>
                        </div>
                        <div class="message-content">
                            <strong>Welcome to the unified AI Swarm interface!</strong>
                            <p style="margin-top: 10px;">Choose your mode:</p>
                            <ul style="margin-top: 10px; margin-left: 20px;">
                                <li><strong>âš¡ Quick Task Mode:</strong> One-off requests, document creation, analysis</li>
                                <li><strong>ğŸ“ Project Mode:</strong> Full consulting engagements with context tracking</li>
                                <li><strong>ğŸ”¬ Research Mode:</strong> Real-time industry intelligence and news</li>
                            </ul>
                            <p style="margin-top: 15px;"><strong>Features:</strong></p>
                            <ul style="margin-top: 5px; margin-left: 20px;">
                                <li>âœ… 22 knowledge documents (30+ years expertise)</li>
                                <li>âœ… Professional formatting</li>
                                <li>âœ… Feedback & learning on every response</li>
                                <li>âœ… Multi-AI consensus validation</li>
                                <li>âœ… Conversation memory across sessions</li>
                                <li>âœ… Voice control - say "Hey Swarm" to command</li>
                                <li>âœ… Research Agent - real-time web intelligence</li>
                            </ul>
                        </div>
                    </div>
                </div>
                
                <!-- Loading Indicator -->
                <div class="loading" id="loadingIndicator">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">AI Swarm is thinking... Searching knowledge base and generating response...</div>
                </div>
                
                <!-- Input Area -->
                <div class="input-area">
                    <textarea id="userInput" placeholder="Type your request here... or say 'Hey Swarm'"></textarea>
                    <div style="display: flex; flex-direction: column; gap: 10px;">
                        <button onclick="sendMessage()">Send</button>
                        <button class="voice-input-btn" id="voiceInputBtn" onclick="startVoiceInput()" title="Click to speak your message">ğŸ¤</button>
                        <label for="fileUpload" style="padding: 10px 20px; background: #e0e0e0; color: #333; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; text-align: center; transition: background 0.2s;">ğŸ“ Upload Files</label>
                        <input type="file" id="fileUpload" multiple accept=".pdf,.docx,.xlsx,.csv,.txt,.png,.jpg,.jpeg" style="display: none;" onchange="handleFileUpload(event)">
                    </div>
                </div>
                
                <!-- File Preview Area -->
                <div id="filePreview" style="margin-top: 10px; display: none;">
                    <div style="font-size: 12px; font-weight: 600; color: #667eea; margin-bottom: 5px;">Attached Files:</div>
                    <div id="fileList" style="display: flex; flex-wrap: wrap; gap: 8px;"></div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- External JavaScript - Order matters! swarm-app.js must load first -->
    <script src="/static/js/swarm-app.js"></script>
    <script src="/static/js/swarm-voice.js"></script>
    
    <!-- Research Agent JavaScript Functions - Added January 23, 2026 -->
    <script>
    // =============================================================================
    // RESEARCH AGENT FUNCTIONS - Added January 23, 2026
    // =============================================================================
    
    // Check research status on page load
    function checkResearchStatus() {
        fetch('/api/research/status')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                var statusDiv = document.getElementById('researchStatus');
                if (data.available) {
                    statusDiv.innerHTML = '<strong>âœ… Status:</strong> Online<br><small>' + 
                        data.capabilities.length + ' research capabilities available</small>';
                    statusDiv.className = 'research-status';
                } else {
                    statusDiv.innerHTML = '<strong>âš ï¸ Status:</strong> Offline<br><small>TAVILY_API_KEY not configured</small>';
                    statusDiv.className = 'research-status error';
                }
            })
            .catch(function(err) {
                var statusDiv = document.getElementById('researchStatus');
                statusDiv.innerHTML = '<strong>âŒ Status:</strong> Error connecting';
                statusDiv.className = 'research-status error';
            });
    }
    
    // Display research results in conversation
    function displayResearchResults(title, data) {
        var content = '<h3>' + title + '</h3>';
        
        if (data.summary) {
            content += '<p style="margin: 10px 0; padding: 10px; background: #f5f5f5; border-radius: 6px;"><strong>Summary:</strong> ' + data.summary + '</p>';
        }
        
        if (data.results && data.results.length > 0) {
            content += '<div style="margin-top: 15px;">';
            data.results.forEach(function(result, idx) {
                content += '<div style="padding: 12px; background: white; border-left: 3px solid #667eea; margin-bottom: 10px; border-radius: 0 6px 6px 0;">';
                content += '<strong>' + (idx + 1) + '. ' + result.title + '</strong><br>';
                content += '<p style="font-size: 13px; color: #555; margin: 5px 0;">' + result.content.substring(0, 200) + '...</p>';
                content += '<a href="' + result.url + '" target="_blank" style="font-size: 12px; color: #667eea;">ğŸ”— Read more</a>';
                content += '</div>';
            });
            content += '</div>';
        } else {
            content += '<p style="color: #999;">No results found.</p>';
        }
        
        addMessage('assistant', content, null, 'research');
    }
    
    // Get Daily Briefing
    function getDailyBriefing() {
        addMessage('user', 'ğŸ“° Get Daily Intelligence Briefing');
        var loading = document.getElementById('loadingIndicator');
        loading.classList.add('active');
        document.querySelector('.loading-text').textContent = 'Generating daily briefing... This may take a moment...';
        
        fetch('/api/research/briefing')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                loading.classList.remove('active');
                
                if (data.success && data.briefing) {
                    var content = '<h3>ğŸ“° Daily Intelligence Briefing</h3>';
                    content += '<p style="font-size: 12px; color: #666;">Generated: ' + data.briefing.generated_at + '</p>';
                    
                    data.briefing.sections.forEach(function(section) {
                        content += '<div style="margin-top: 15px;">';
                        content += '<h4>' + section.title + '</h4>';
                        if (section.summary) {
                            content += '<p style="font-size: 13px; color: #555; margin: 5px 0;">' + section.summary + '</p>';
                        }
                        if (section.items && section.items.length > 0) {
                            section.items.forEach(function(item) {
                                content += '<div style="padding: 10px; background: #f9f9f9; margin: 5px 0; border-radius: 6px;">';
                                content += '<strong style="font-size: 13px;">' + item.title + '</strong><br>';
                                content += '<a href="' + item.url + '" target="_blank" style="font-size: 11px; color: #667eea;">ğŸ”— Read more</a>';
                                content += '</div>';
                            });
                        }
                        content += '</div>';
                    });
                    
                    addMessage('assistant', content, null, 'research');
                } else {
                    addMessage('assistant', 'âŒ Could not generate briefing: ' + (data.error || 'Unknown error'));
                }
            })
            .catch(function(err) {
                loading.classList.remove('active');
                addMessage('assistant', 'âŒ Error: ' + err.message);
            });
    }
    
    // Search Industry News
    function searchIndustryNews() {
        addMessage('user', 'ğŸ“° Search Industry News');
        var loading = document.getElementById('loadingIndicator');
        loading.classList.add('active');
        document.querySelector('.loading-text').textContent = 'Searching for industry news...';
        
        fetch('/api/research/industry-news')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                loading.classList.remove('active');
                if (data.success) {
                    displayResearchResults('ğŸ“° Industry News', data);
                } else {
                    addMessage('assistant', 'âŒ Error: ' + data.error);
                }
            })
            .catch(function(err) {
                loading.classList.remove('active');
                addMessage('assistant', 'âŒ Error: ' + err.message);
            });
    }
    
    // Search Regulations
    function searchRegulations() {
        addMessage('user', 'âš–ï¸ Search Regulations & Compliance');
        var loading = document.getElementById('loadingIndicator');
        loading.classList.add('active');
        document.querySelector('.loading-text').textContent = 'Searching for regulatory updates...';
        
        fetch('/api/research/regulations')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                loading.classList.remove('active');
                if (data.success) {
                    displayResearchResults('âš–ï¸ Regulatory Updates', data);
                } else {
                    addMessage('assistant', 'âŒ Error: ' + data.error);
                }
            })
            .catch(function(err) {
                loading.classList.remove('active');
                addMessage('assistant', 'âŒ Error: ' + err.message);
            });
    }
    
    // Search Studies
    function searchStudies() {
        addMessage('user', 'ğŸ”¬ Search Research Studies');
        var loading = document.getElementById('loadingIndicator');
        loading.classList.add('active');
        document.querySelector('.loading-text').textContent = 'Searching for research studies...';
        
        fetch('/api/research/studies')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                loading.classList.remove('active');
                if (data.success) {
                    displayResearchResults('ğŸ”¬ Research Studies', data);
                } else {
                    addMessage('assistant', 'âŒ Error: ' + data.error);
                }
            })
            .catch(function(err) {
                loading.classList.remove('active');
                addMessage('assistant', 'âŒ Error: ' + err.message);
            });
    }
    
    // Search Competitors
    function searchCompetitors() {
        addMessage('user', 'ğŸ¢ Competitor Analysis');
        var loading = document.getElementById('loadingIndicator');
        loading.classList.add('active');
        document.querySelector('.loading-text').textContent = 'Analyzing competitors...';
        
        fetch('/api/research/competitors')
            .then(function(r) { return r.json(); })
            .then(function(data) {
                loading.classList.remove('active');
                if (data.success) {
                    displayResearchResults('ğŸ¢ Competitor Analysis', data);
                } else {
                    addMessage('assistant', 'âŒ Error: ' + data.error);
                }
            })
            .catch(function(err) {
                loading.classList.remove('active');
                addMessage('assistant', 'âŒ Error: ' + err.message);
            });
    }
    
    // Search Leads
    function searchLeads() {
        var industry = prompt('Enter industry to search (or leave blank for general):', '');
        
        addMessage('user', 'ğŸ¯ Find Potential Leads' + (industry ? ' in ' + industry : ''));
        var loading = document.getElementById('loadingIndicator');
        loading.classList.add('active');
        document.querySelector('.loading-text').textContent = 'Searching for potential leads...';
        
        var url = '/api/research/leads';
        if (industry) {
            url += '?industry=' + encodeURIComponent(industry);
        }
        
        fetch(url)
            .then(function(r) { return r.json(); })
            .then(function(data) {
                loading.classList.remove('active');
                if (data.success) {
                    displayResearchResults('ğŸ¯ Potential Leads', data);
                } else {
                    addMessage('assistant', 'âŒ Error: ' + data.error);
                }
            })
            .catch(function(err) {
                loading.classList.remove('active');
                addMessage('assistant', 'âŒ Error: ' + err.message);
            });
    }
    
    // Custom Research
    function customResearch() {
        var query = document.getElementById('researchQuery').value.trim();
        if (!query) {
            alert('Please enter a research topic');
            return;
        }
        
        addMessage('user', 'ğŸ” Research: ' + query);
        var loading = document.getElementById('loadingIndicator');
        loading.classList.add('active');
        document.querySelector('.loading-text').textContent = 'Researching "' + query + '"...';
        
        fetch('/api/research/topic', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify({ topic: query })
        })
            .then(function(r) { return r.json(); })
            .then(function(data) {
                loading.classList.remove('active');
                if (data.success) {
                    displayResearchResults('ğŸ” Research: ' + query, data);
                    document.getElementById('researchQuery').value = '';
                } else {
                    addMessage('assistant', 'âŒ Error: ' + data.error);
                }
            })
            .catch(function(err) {
                loading.classList.remove('active');
                addMessage('assistant', 'âŒ Error: ' + err.message);
            });
    }
    
    // Update switchMode to handle research mode
    var originalSwitchMode = typeof switchMode === 'function' ? switchMode : null;
    
    // Override switchMode after swarm-app.js loads
    document.addEventListener('DOMContentLoaded', function() {
        // Wait a bit for swarm-app.js to fully initialize
        setTimeout(function() {
            checkResearchStatus();
        }, 500);
    });
    </script>
</body>
</html>

<!-- I did no harm and this file is not truncated -->
